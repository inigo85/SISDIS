<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head>

</h:head>
<h:body>

	<p:layout fullPage="true" id="lay">
		<p:layoutUnit position="center">
			<h:form>

				<p:growl id="toolbar" />

				<p:toolbar>
				    <p:toolbarGroup style="margin-top:0.8%;margin-left:37%">
				    <p:outputLabel>
				    UBUCalendar - Administración
				    </p:outputLabel>
					</p:toolbarGroup>
					<p:toolbarGroup align="right" style="margin-right:2%">
						
						<p:menuButton value="Opciones" >
							<p:menuitem value=" Ir al calendario"  icon="ui-icon-calendar" action="#{adminUserBean.irAlCalendario()}"/>
							<p:menuitem value=" Desconectar" icon="ui-icon-power" action="#{adminUserBean.desconectar()}"/>
						</p:menuButton>

					</p:toolbarGroup>


				</p:toolbar>
			</h:form>
			
			<p:tabView id="tabView">

				<p:tab id="tab1" title="Usuarios">
					<h:form id="form">

						<p:growl id="messages" showDetail="true" />

						<p:dataTable id="user" var="usuario" styleClass="classUser"
							value="#{adminUserBean.listaUsuarios}" editable="true"
							widgetVar="userTable" paginator="true"
							paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink} {RowsPerPageDropdown}"
							rows="25" type="none" paginatorPosition="bottom">


							<p:ajax event="rowEdit" listener="#{adminUserBean.onEdit}"
								update=":tabView:form:messages" />
							<p:ajax event="rowEditCancel"
								listener="#{adminUserBean.onCancel}"
								update=":tabView:form:messages" />

							<p:column headerText="Nombre" style="width:125px"
								sortBy="#{usuario.nombre}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{usuario.nombre}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{usuario.nombre}" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Email" style="width:125px">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{usuario.email}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{usuario.email}" label="Email" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Tipo" style="width:125px"
								sortBy="#{usuario.esAdmin}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{usuario.esAdmin}" />
									</f:facet>
									<f:facet name="input">
										<p:selectBooleanCheckbox value="#{usuario.esAdmin}" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Contraseña" style="width:125px">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{usuario.contrasena}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{usuario.contrasena}" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Opciones" style="width:50px">
								<p:rowEditor />
								<p:commandLink id="deleteLink"
									styleClass="ui-icon ui-icon-trash"
									action="#{adminUserBean.onDelete(usuario.id)}"
								    update=":tabView:form:user">
									
									</p:commandLink>
							</p:column>
						</p:dataTable>

						<p:commandLink id="add"
							actionListener="#{adminUserBean.anadirUsuario}"
							value="Añadir usuario" update=":tabView:form:user"
							oncomplete="editLastDatatableRow('classUser');">
						</p:commandLink>

					</h:form>

				</p:tab>

				<p:tab id="tab2" title="Eventos">
					<h:form id="formEvento">

						<p:growl id="messagesEventos" showDetail="true" />

						<p:dataTable id="eve" var="evento"
							value="#{adminEventoBean.listaTareas}" editable="true"
							widgetVar="eveTable" styleClass="classEvento" paginator="true"
							paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink} {RowsPerPageDropdown}"
							rows="25" type="none" paginatorPosition="bottom">

							<p:ajax event="rowEdit" listener="#{adminEventoBean.onEdit}"
								update=":tabView:formEvento:messagesEventos" />
							<p:ajax event="rowEditCancel"
								listener="#{adminEventoBean.onCancel}"
								update=":tabView:formEvento:messagesEventos" />

							<p:column headerText="Nombre" style="width:15%">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{evento.nombre}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{evento.nombre}" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Fecha inicio" style="width:12%"
								sortBy="#{evento.fecha_inicio}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{evento.fecha_formateada}" />
									</f:facet>
									<f:facet name="input">
										<p:calendar effect="slideDown" value="#{evento.fecha_inicio}"
											pattern="MM/dd/yyyy HH:mm" locale="es" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Fecha fin" style="width:12%"
								sortBy="#{evento.fecha_fin}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{evento.fecha_formateada_fin}" />
									</f:facet>
									<f:facet name="input">
										<p:calendar effect="slideDown" value="#{evento.fecha_fin}"
											pattern="MM/dd/yyyy HH:mm" locale="es" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Todo el dia" style="width:5%">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{evento.todo_el_día}" />
									</f:facet>
									<f:facet name="input">
										<p:selectBooleanCheckbox value="#{evento.todo_el_día}" />
									</f:facet>
								</p:cellEditor>
							</p:column>


							<p:column headerText="Descripción" style="width:30%">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{evento.descripción}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{evento.descripción}" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Nombre usuario" style="width:15%"
								sortBy="#{evento.nombreUsuario}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{evento.nombreUsuario}" />
									</f:facet>
									<f:facet name="input">
										<p:selectOneMenu value="#{evento.nombreUsuario}"
											style="width:100%">
											<f:selectItems value="#{adminEventoBean.listaUsuarios}"
												var="listaU" itemLabel="#{listaU}" itemValue="#{listaU}"
												style="width:100%" />
										</p:selectOneMenu>
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Opciones">
								<p:rowEditor />
								<p:commandLink id="deleteLink"
									styleClass="ui-icon ui-icon-trash"
									action="#{adminEventoBean.onDelete(evento.id)}"
									update=":tabView:formEvento:eve" />
							</p:column>

						</p:dataTable>

						<p:commandLink id="add"
							actionListener="#{adminEventoBean.anadirEvento}"
							value="Añadir evento" update=":tabView:formEvento:eve"
							oncomplete="editLastDatatableRow('classEvento');">
						</p:commandLink>


					</h:form>

				</p:tab>


			</p:tabView>

		</p:layoutUnit>

	</p:layout>
	<SCRIPT type="text/javascript">
		PrimeFaces.locales['es'] = {
			closeText : 'Hecho',
			prevText : 'Anterior',
			nextText : 'Siguiente',
			monthNames : [ 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo',
					'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre',
					'Noviembre', 'Diciembre' ],
			monthNamesShort : [ 'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
					'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic' ],
			dayNames : [ 'Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves',
					'Viernes', 'Sábado' ],
			dayNamesShort : [ 'Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab' ],
			dayNamesMin : [ 'D', 'L', 'M', 'X', 'J', 'V', 'S' ],
			weekHeader : 'Semana',
			firstDay : 1,
			isRTL : false,
			showMonthAfterYear : false,
			yearSuffix : '',
			timeOnlyTitle : 'Sólo hora',
			timeText : 'Tiempo',
			hourText : 'Hora',
			minuteText : 'Minuto',
			secondText : 'Segundo',
			currentText : 'Fecha actual',
			ampm : false,
			month : 'Mes',
			week : 'Semana',
			day : 'Día',
			allDayText : 'Todo el día'
		};
	</SCRIPT>

	<script type="text/javascript">
		function editLastDatatableRow(name) {

			jQuery('.' + name + ' tr').last().find('span.ui-icon-pencil').each(
					function() {
						jQuery(this).click()
					});
		}
	</script>
</h:body>
</html>
